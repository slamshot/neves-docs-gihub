# 流程设计器

​		基于flowable流程引擎封装的流程快速开发设计，该流程设计器是一块独立的流程业务操作系统，分为主页,开发，流程，监控，系统五大模块

## 一. 功能菜单介绍
### 1. 主页

主页主要是以统计图的形式展示了流程系统中流程业务的统计情况

![主页](..\images\flow\主页.png)

### 2. 开发

开发包含模型管理，数据源管理，所属系统管理，流程分类管理四个模块

![开发](..\images\flow\开发.png)

#### 2.1. 模型管理

流程模型开发管理、支持单个添加、批量导入、导出、流程发布、取消发布、删除、查看xml、查看流程图功能   

#### 2.2. 数据源管理

数据源管理是对流程业务体系中的数据源进行同意管理

#### 2.3. 所属系统管理

所属系统管理是流程中的归属系统管理的模块，可以进行增加修改删除等操作

#### 2.4. 流程分类管理

流程分类管理是流程中的归属分类管理的模块，可以进行增加修改删除等操作



### 3.流程

![流程](..\images\flow\流程.png)

#### 3.1 流程库

流程库是管理已经设计好的流程的分类菜单，这里可以管理流程进行批量导入、导出、流程发布、取消发布、删除、查看xml、查看流程图功能   

#### 3.2 发起流程

发起流程就是对流程业务启动挂起的功能

这里启动 采用的是模拟表单，主键代表是表单的主键id，变量名，变量值是模拟表单数据

![流程](..\images\flow\启动.png)

#### 3.3 实列管理

实列管理是当前系统中流程的状态显示，可以进行删除，挂起，查看流程流转状态

#### 3.4 待办管理

待办管理是处理当前用户下待处理的流程业务

#### 3.5 已办管理

已办管理是查看当前用户下处理过的流程业务

#### 3.6 我发起的

查看我发起流程的状态信息

#### 3.7 委托设置

将任务委托给别人进行处理


## 4.监控

监控这里是对系统流程的超时监控，请求监控的信息展示

![监控](..\images\flow\监控.png)

## 5.系统

系统管理包含系统中组织结构，资源管理，权限管理操作

### 5.1 组织结构

组织结构是对用户管理，组管理，组类型管理对其增删改查的操作

### 5.2 资源管理

资源管理是对当前系统菜单维护

### 5.3 权限管理

权限管理是对用户和组权限的分配

![系统](..\images\flow\系统.png)

## 二. 开发流程

### 1. 新增流程

在开发-模型管理中设计流程

![系统](..\images\flow\流程设计.png)

### 2. 流程设计区

![系统](..\images\flow\流程设计区.png)

#### 2.1.流程中组件介绍

展示所有流程节点类型，以拖拉拽的形式放入设计区

------



#####  ![开始节点](..\images\flow\开始节点.png)	开始节点

| 基础属性       | 描述         | 默认值                            |
| -------------- | ------------ | --------------------------------- |
| 编号           | 节点唯一编号 |                                   |
| 名称           | 节点名称     |                                   |
| 说明           | 节点说明     |                                   |
| **执行监听器** |              |                                   |
| 事件           | 触发时机     | 开始/结束/任务转移                |
| 类型           | 实现方式     | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码 |                                   |

------



#####  ![结束节点](..\images\flow\结束节点.png)	结束节点

| 基础属性       | 描述         | 默认值                            |
| -------------- | ------------ | --------------------------------- |
| 编号           | 节点唯一编号 |                                   |
| 名称           | 节点名称     |                                   |
| 说明           | 节点说明     |                                   |
| **执行监听器** |              |                                   |
| 事件           | 触发时机     | 开始/结束/任务转移                |
| 类型           | 实现方式     | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码 |                                   |


------



#####  ![人工任务](..\images\flow\人工任务.png)	人工任务

| 基础属性         | 描述                                 | 默认值                            |
| ---------------- | ------------------------------------ | --------------------------------- |
| 编号             | 节点唯一编号                         |                                   |
| 名称             | 节点名称                             |                                   |
| 说明             | 节点说明                             |                                   |
| 表单url          | 使用表单的路径                       |                                   |
| **执行监听器**   |                                      |                                   |
| 事件             | 触发时机                             | 开始/结束/任务转移                |
| 类型             | 实现方式                             | groovy表达式/类/表达式/委托表达式 |
| 实现             | 具体逻辑代码                         |                                   |
| **多实例配置**   |                                      |                                   |
| 多实例           | 多实例开关                           | false/true                        |
| 顺序执行         | 是否按照顺序进行审批                 | true/false                        |
| 全部执行         | 是否需要所有人都进行审批             | true/false                        |
| 不通过策略       | 当结果不通过时的处理策略             | 回退/流转                         |
| 通过策略         | 审批通过条件                         | 默认/百分比/自定义脚本            |
| 表达式           | 用于编写通过策略后两种策略的逻辑代码 |                                   |
| **处理命令**     |                                      |                                   |
| 编号             | 处理命令编号                         |                                   |
| 名称             | 显示在表单上按钮名称                 |                                   |
| 类型             | 命令类型                             |                                   |
| **任务分配**     |                                      |                                   |
| 类型             | 审批人类型                           | 用户/角色/组                      |
| 策略             |                                      | 包含/排除/固定                    |
| 表达式           | 审批人表达式                         |                                   |
| **超时任务配置** |                                      |                                   |
| 是否启用         | 是否启用超时策略                     |                                   |
| 继承流程配置     | 是否继承使用流程的配置               |                                   |
| 截止时间         |                                      |                                   |
| 是否催办         | 是否开启催办                         |                                   |
| 截止时间前       | 设置催办时间                         |                                   |
| 重复             | 设置催办是否重复及重复间隔           |                                   |
| 执行器           | 超时后执行操作                       |                                   |
| 类型             | 超时后执行操作类型                   |                                   |
| **处理策略配置** |                                      |                                   |
| 无对应处理人策略 | 当节点没有设置处理人时的策略         |                                   |
| 自动同意规则     | 自动同意的条件                       |                                   |
| 跳过策略         | 跳过本节点的条件                     |                                   |
| 生成跳过记录     | 是否生成对应记录                     |                                   |
| 跳过意见         | 生成记录时跳过的意见                 |                                   |
|                  |                                      |                                   |



------



#####  ![服务任务](..\images\flow\服务任务.png)	服务任务

| 基础属性       | 描述                                 | 默认值                            |
| -------------- | ------------------------------------ | --------------------------------- |
| 编号           | 节点唯一编号                         |                                   |
| 名称           | 节点名称                             |                                   |
| 说明           | 节点说明                             |                                   |
| **高级属性**   |                                      |                                   |
| 服务类型       |                                      |                                   |
| 是否可触发     |                                      |                                   |
| 实现类型       |                                      |                                   |
| 实现表达式     |                                      |                                   |
| **执行监听器** |                                      |                                   |
| 事件           | 触发时机                             | 开始/结束/任务转移                |
| 类型           | 实现方式                             | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码                         |                                   |
| **多实例配置** |                                      |                                   |
| 多实例         | 多实例开关                           | false/true                        |
| 顺序执行       | 是否按照顺序进行审批                 | true/false                        |
| 全部执行       | 是否需要所有人都进行审批             | true/false                        |
| 不通过策略     | 当结果不通过时的处理策略             | 回退/流转                         |
| 通过策略       | 审批通过条件                         | 默认/百分比/自定义脚本            |
| 表达式         | 用于编写通过策略后两种策略的逻辑代码 |                                   |

------



##### ![脚本任务](..\images\flow\脚本任务.png)	脚本任务

| 基础属性       | 描述                                 | 默认值                            |
| -------------- | ------------------------------------ | --------------------------------- |
| 编号           | 节点唯一编号                         |                                   |
| 名称           | 节点名称                             |                                   |
| 说明           | 节点说明                             |                                   |
| **高级属性**   |                                      |                                   |
| 脚本格式       | 脚本类型                             | JavaScript/groovy                 |
| 实现           | 具体逻辑代码                         |                                   |
| **执行监听器** |                                      |                                   |
| 事件           | 触发时机                             | 开始/结束/任务转移                |
| 类型           | 实现方式                             | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码                         |                                   |
| **多实例配置** |                                      |                                   |
| 多实例         | 多实例开关                           | false/true                        |
| 顺序执行       | 是否按照顺序进行审批                 | true/false                        |
| 全部执行       | 是否需要所有人都进行审批             | true/false                        |
| 不通过策略     | 当结果不通过时的处理策略             | 回退/流转                         |
| 通过策略       | 审批通过条件                         | 默认/百分比/自定义脚本            |
| 表达式         | 用于编写通过策略后两种策略的逻辑代码 |                                   |

------



#####  ![手工任务](..\images\flow\手工任务.png)	手工任务

| 基础属性       | 描述                                 | 默认值                            |
| -------------- | ------------------------------------ | --------------------------------- |
| 编号           | 节点唯一编号                         |                                   |
| 名称           | 节点名称                             |                                   |
| 说明           | 节点说明                             |                                   |
| **执行监听器** |                                      |                                   |
| 事件           | 触发时机                             | 开始/结束/任务转移                |
| 类型           | 实现方式                             | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码                         |                                   |
| **多实例配置** |                                      |                                   |
| 多实例         | 多实例开关                           | false/true                        |
| 顺序执行       | 是否按照顺序进行审批                 | true/false                        |
| 全部执行       | 是否需要所有人都进行审批             | true/false                        |
| 不通过策略     | 当结果不通过时的处理策略             | 回退/流转                         |
| 通过策略       | 审批通过条件                         | 默认/百分比/自定义脚本            |
| 表达式         | 用于编写通过策略后两种策略的逻辑代码 |                                   |

------



#####  ![接收任务](..\images\flow\接收任务.png)	接收任务

| 基础属性       | 描述                                 | 默认值                            |
| -------------- | ------------------------------------ | --------------------------------- |
| 编号           | 节点唯一编号                         |                                   |
| 名称           | 节点名称                             |                                   |
| 说明           | 节点说明                             |                                   |
| **执行监听器** |                                      |                                   |
| 事件           | 触发时机                             | 开始/结束/任务转移                |
| 类型           | 实现方式                             | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码                         |                                   |
| **多实例配置** |                                      |                                   |
| 多实例         | 多实例开关                           | false/true                        |
| 顺序执行       | 是否按照顺序进行审批                 | true/false                        |
| 全部执行       | 是否需要所有人都进行审批             | true/false                        |
| 不通过策略     | 当结果不通过时的处理策略             | 回退/流转                         |
| 通过策略       | 审批通过条件                         | 默认/百分比/自定义脚本            |
| 表达式         | 用于编写通过策略后两种策略的逻辑代码 |                                   |

------



#####  ![排他网关](..\images\flow\排他网关.png)	排他网关

| 基础属性 | 描述         | 默认值 |
| -------- | ------------ | ------ |
| 编号     | 节点唯一编号 |        |
| 名称     | 节点名称     |        |
| 说明     | 节点说明     |        |

------



#####  ![并行网关](..\images\flow\并行网关.png)	并行网关

| 基础属性 | 描述         | 默认值 |
| -------- | ------------ | ------ |
| 编号     | 节点唯一编号 |        |
| 名称     | 节点名称     |        |
| 说明     | 节点说明     |        |

------



#####  ![包容网关](..\images\flow\包容网关.png)	包容网关

| 基础属性 | 描述         | 默认值 |
| -------- | ------------ | ------ |
| 编号     | 节点唯一编号 |        |
| 名称     | 节点名称     |        |
| 说明     | 节点说明     |        |

------



#####  ![子流程](..\images\flow\子流程.png)	子流程

| 基础属性       | 描述                                 | 默认值                            |
| -------------- | ------------------------------------ | --------------------------------- |
| 编号           | 节点唯一编号                         |                                   |
| 名称           | 节点名称                             |                                   |
| 说明           | 节点说明                             |                                   |
| **执行监听器** |                                      |                                   |
| 事件           | 触发时机                             | 开始/结束/任务转移                |
| 类型           | 实现方式                             | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码                         |                                   |
| **多实例配置** |                                      |                                   |
| 多实例         | 多实例开关                           | false/true                        |
| 顺序执行       | 是否按照顺序进行审批                 | true/false                        |
| 全部执行       | 是否需要所有人都进行审批             | true/false                        |
| 不通过策略     | 当结果不通过时的处理策略             | 回退/流转                         |
| 通过策略       | 审批通过条件                         | 默认/百分比/自定义脚本            |
| 表达式         | 用于编写通过策略后两种策略的逻辑代码 |                                   |

------



#####  ![调用子流程](..\images\flow\调用子流程.png)	调用子流程

| 基础属性       | 描述                                 | 默认值                            |
| -------------- | ------------------------------------ | --------------------------------- |
| 编号           | 节点唯一编号                         |                                   |
| 名称           | 节点名称                             |                                   |
| 说明           | 节点说明                             |                                   |
| **高级属性**   |                                      |                                   |
| 外部子流程编号 | 要调用的流程的编号                   |                                   |
| 业务主键       |                                      |                                   |
| 继承主流程变量 | 是否继承主流程的变量                 |                                   |
| 继承主流程主键 | 是否继承主流程的主键                 |                                   |
| 输入参数       |                                      |                                   |
| 输出参数       |                                      |                                   |
| **执行监听器** |                                      |                                   |
| 事件           | 触发时机                             | 开始/结束/任务转移                |
| 类型           | 实现方式                             | groovy表达式/类/表达式/委托表达式 |
| 实现           | 具体逻辑代码                         |                                   |
| **多实例配置** |                                      |                                   |
| 多实例         | 多实例开关                           | false/true                        |
| 顺序执行       | 是否按照顺序进行审批                 | true/false                        |
| 全部执行       | 是否需要所有人都进行审批             | true/false                        |
| 不通过策略     | 当结果不通过时的处理策略             | 回退/流转                         |
| 通过策略       | 审批通过条件                         | 默认/百分比/自定义脚本            |
| 表达式         | 用于编写通过策略后两种策略的逻辑代码 |                                   |

#### 2.2 工具栏

​![工具栏](..\images\flow\工具栏.png)

​设计过程中常用工具：打开文件、保存、下载源文件、验证 | 删除节点、撤回、重做 | 左对齐、水平居中、右对齐、上对齐、垂直居中、下对齐 |  还原、放大、缩小 | 历史记录

#### 2.3 属性栏

​展示、编辑流程、节点属性

![属性栏](..\images\flow\属性栏.png)



### 3. 数据源管理

​		管理流程所用到的数据源

![数据源管理](..\images\flow\数据源管理.png)

### 4. 所属系统管理

​		管理流程所属系统分类

​		![所属系统管理](..\images\flow\所属系统管理.png)

### 5. 流程分类管理

​		管理流程的分类

![流程分类管理](..\images\flow\流程分类管理.png)


### 6. 流程创建示例

#### 6.1 创建一个简单的流程

![流程1](..\images\flow\流程１.png)

#### 6.2 流程配置介绍

##### 6.2.1. 流程信息

主要介绍功能就是表单url  这个设置是用来项目中表单挂载流程的

##### 6.2.2. 版本信息

版本信息记录了流程图节点和配置修改的记录，里面可以更新，发布流程信息

##### 6.2.3. 全局变量

定义了流程中要使用的变量信息

##### 6.2.4. 执行监听器

监听器可以选择在流程事件中使用groovy表达式去执行业务逻辑，实现采用接口调用的方式

![监听器](..\images\flow\监听器.png)

接口调用请求示例

```
import org.apache.http.HttpResponse; 
import org.apache.http.client.entity.UrlEncodedFormEntity; 
import org.apache.http.client.methods.HttpPost; 
import org.apache.http.impl.client.CloseableHttpClient; 
import org.apache.http.impl.client.HttpClients; 
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;
import java.net.http.HttpClient; 
import java.net.http.HttpRequest; 
import java.util.List;
import java.util.ArrayList;

String url="http://127.0.0.1:6600/testhelentity/updateTest";

HttpPost mPost = new HttpPost(url); 

mPost.addHeader("Content-Type", "application/x-www-form-urlencoded"); 
/**
 * 组装需要发送的数据
 */
List<BasicNameValuePair> pairs = new ArrayList<BasicNameValuePair>(); 
 pairs.add(new BasicNameValuePair("id",${id})); 
mPost.setEntity(new UrlEncodedFormEntity(pairs, "UTF-8")); 
/**
 * 向服务器发送请求
 */
CloseableHttpClient mHttpClient = HttpClients.createDefault(); 

HttpResponse response = mHttpClient.execute(mPost); 

int res = response.getStatusLine().getStatusCode(); 

if (res == 200) { 
    return response; 
}else{ 
    throw(new Exception(response.toString())); 
}

```

##### 6.2.5. 通知配置

里面包含邮件和短信通知，目前短信通知功能暂时无法使用

邮件通知选择接收人，抄送人，是选择人员后，自动去匹配用户管理里中人员的邮箱信息


##### 6.2.6. 任务超时配置

可以根据任务类型去设定超时时间，去进行自动审批，退回，自定义表达式去去指定业务逻辑

##### 6.2.7. 全局按钮配置

介绍了整个流程中执行的按钮功能内容


#### 6.3 流程节点介绍

节点信息这里着重介绍一下上面设计流程没有涉及到的配置


![流程节点介绍](..\images\flow\流程节点介绍.png)

##### 6.3.1. 多实例配置

启用多实例配置后，可以在一个节点上分配多个人员执行该任务

顺序执行：按照分配的人员顺序进行审批

全部执行：该节点上的人员必须全部执行才能进行到下一个节点

不通过策略：包含回退和流转节点

通过策略：1.有百分比（人员同意占的百分之达到配置百分比就可以通过）2.自定义脚本：可以进行自定义配置（如指定流转节点）

![多实例配置](..\images\flow\多实例配置.png)


##### 6.3.2. 处理策略配置

![处理策略配置](..\images\flow\处理策略配置.png)
